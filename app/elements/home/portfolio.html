<dom-module id="my-portfolio">
    <template>
        <style>
            :host {
                display: block;
                background: var(--dark-primary-color);
            }

            paper-card {
                margin: 20px 0px;
                background-color: var(--text-primary-color);
                min-height: 620px;
            }

            h1 {
                margin: 0px;
            }
            .row {
                margin-bottom: 0px;
            }

            .portfolio {
                color: var(--light-primary-color);
            }

            .site {
                opacity: 0;
            }

            img.responsive-img {
                height:  350px;
                width:  100%;
            }
            paper-button {
                color: var(--light-primary-color);
            }
            .desc {
                display: block;
                display: -webkit-box;
                height: 109.2px;
                -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                line-height: 1.625;
                text-overflow: ellipsis;
            }
        </style>
        <div class="row">
            <template is="dom-repeat" items="{{profile.portfolio}}" as="site">
            <div class="col s12 l4">
                <paper-card id="site-{{index}}" class="site" elevation="5">
                    <div class="header style-scope paper-card center">
                        <div class="title-text style-scope paper-card center">{{site.name}}</div>
                    </div>
                    <div class="card-content">
                        <a href="{{site.site}}"><img class="responsive-img" src="{{site.image}}"></a>
                        <p class="desc">{{site.description}}</p>
                    </div>
                </paper-card>
            </div>
            </template>

            <div class="center">
                <paper-button on-tap="seeMore">More</paper-button>
            </div>
        </div>
        <iron-signals on-iron-signal-scroll="scrolled"></iron-signals>
    </template>
    <script>
        Polymer({
            is: 'my-portfolio',
            behaviors: [
                Polymer.NeonAnimationRunnerBehavior
            ],
            listeners: {
                'scroll': 'scrolled',
                'neon-animation-finish': '_onNeonAnimationFinish'
            },
            properties: {
                profile: {
                    observer: 'profileReady'
                },
                started: false,
                allDisplayed: false,
                animationConfig: {
                    value: function() {
                        return {};
                    }
                }
            },
            seeMore: function () {
                page('/github');
            },
            _onNeonAnimationFinish: function (e) {
                this.animations[e.detail] = true;
            },
            scrolled: function (e) {
                if (this.allDisplayed) {
                    return;
                }

                if (e.detail.scrollTop >= 600 ||
                    (e.detail.clientWidth < 800 && e.detail.scrollTop >= 800)
                    ) {
                    if (!this.started) {
                        this.start(e.detail.scrollTop);
                    }
                    this.started = true;
                }

                if (e.detail.scrollTop >= 900 ||
                    (e.detail.clientWidth < 800 && e.detail.scrollTop >= 1100)
                    ) {
                    this.playNext(e.detail.scrollTop, e.detail.clientWidth);
                }
            },
            start: function () {
                this.animations = [];
                for (var i = 0; i < this.profile.portfolio.length; i++) {
                    this.animations.push(false);
                    this.animationConfig['site-' + i] = {
                        name: this.profile.portfolio[i].animation,
                        node: document.querySelector('#site-' + i),
                    };
                }

            },
            playNext: function (scroll, width) {
                var indexToPlay = -1,

                indexToPlay = this.animations.length;

                for (var i = 0; i < indexToPlay; i++) {
                    if (!this.animations[i]) {
                        document.querySelector('#site-' + i).style.opacity = 1;
                        this.playAnimation('site-' + i, i);
                    }
                }

            },
        });
    </script>
</dom-module>
